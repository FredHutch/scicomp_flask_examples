# Flask Applications the SciComp Way

Use these templates to build your own
[Flask](http://flask.pocoo.org/) application in
a way that will be supported by
[SciComp](https://teams.fhcrc.org/sites/citwiki/SciComp/Pages/Home.aspx?TreeField=Wiki_x0020_Page_x0020_Categories).

## What is supported/required?

### Python 3

Python 3 was released in 2008 and Python 3.x should be used for all
new projects. If you have an existing Python 2 codebase, contact
SciComp for help with porting it to Python 3.

### Virtual Environments

Virtual Environments enable you to have separate libraries and
interpreters for each project/application, and provide a
helpful way to manage your app's dependencies (specifically,
the best practice is to list your dependencies in a
`requirements.txt` file generated by `pip freeze`).

We recommend using `virtualenvwrapper` because it makes
using virtual environments even easier.



### Unit Tests

Flask makes it easy to add unit tests to your application.
Unit tests give you confidence that your app works the way
it's supposed to.

Every route in a Flask app should have at least one unit test.

### Database Access

For most new applications, we recommend
[SQLAlchemy](http://www.sqlalchemy.org/), which provides
an Object-Relational Mapper (ORM) for Python.

There are some cases where using an ORM is overkill
and you just need to run some simple queries.
In these cases, you can use the
[DB API](https://wiki.python.org/moin/DatabaseInterfaces)
module for your RDBMS (MySQL, PostgreSQL, sqlite).
When using these low-level modules,
you must always write code in such a way as to avoid
[SQL injection](https://en.wikipedia.org/wiki/SQL_injection).
For example, **never do this**:

```python
# Never do this -- insecure!
symbol = 'RHAT'
c.execute("SELECT * FROM stocks WHERE symbol = '%s'" % symbol)
```

Instead do this:

```python
t = ('RHAT',)
c.execute('SELECT * FROM stocks WHERE symbol=?', t)
```

?? Do we recommend/only support a specific RDBMS?
I would say that we should allow sqlite3 for testing and
development since it's easy and many systems already have it installed,
and you can do in-memory databases. But require PostgreSQL or MySQL
for production. ??



### REST Access

If your application is meant to expose a service that other
code can consume, use the
[Flast-RESTful](https://flask-restful-cn.readthedocs.io/en/0.3.5/)
module.

### Other Supported/Recommended Modules

(??)

* [SciPy](https://www.scipy.org/)
* [NumPy](http://www.numpy.org/)
* [pandas](http://pandas.pydata.org/)
* ??

### Interacting with the gizmo cluster

?? Do we need this section ?? Are flask apps allowed to submit jobs
to the cluster ??

### My app needs to call some R code

We recommend that you port the R code to Python.

(??)

### Use GitHub for version control

Store your code in a GitHub repository (ADD MORE HERE)

### Helpful Tools for code development

#### Linters

We strongly recommend using `linters` when developing
Python code. Linters such as `pylint`, `pyflakes`,
and `flake8` (which combines the first two) will point
out syntactic, stylistic, logical, and many other issues
with your code. Ideally, code should be free of linting
warnings before it's committed to Git.

The [Atom](https://atom.io/) text editor has add-on packages
which enable linting right inside your editing window.

#### Profiling

[Profiling](https://docs.python.org/2/library/profile.html)
helps you find the parts of your code that run slowly and
can be optimized.

### Continuous Integration (CI)

Use [Travis CI](https://travis-ci.org) or
[circleci](https://circleci.com/) to automate the testing
and deployment of your code.

(should we require CI? we can at least illustrate it by
example in this repository)
